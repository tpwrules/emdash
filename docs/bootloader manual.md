Welcome to the manual for the bootloader. The bootloader is designed to be easy and safe to use. This manual is divided into two sections. [Overview](#overview) describes the tasks and features of the bootloader. [PC Programmer](#pc-programmer) describes how to use the included PC-based programmer software.

The protocol is documented in `boot/src_11c24/protocol.h`.

# Overview

## Features

The bootloader allows the internal Flash memory of the LPC11C24 to be programmed over the CAN bus. The bootloader can survive a corrupt or buggy application, an incomplete flash, or even power loss while programming. The bootloader also has a system ID to allow multiple bootloaders to exist on the same CAN bus without interference.

## Application

The application is launched by the bootloader. It is protected from corruption by a CRC32 checksum. If the checksum is incorrect, the bootloader will refuse to start the application.

There are 28KiB (28,672 bytes) available for the application. The application memory image is generated by the MCUXpresso software and programmed by the bootloader directly into flash starting at address 0x4000.

The following application memory images are used:

* The dashboard application: `dash_11c24/Debug/dash_11c24.bin`
* The wheelboard application: `wheel_11c24/Debug/wheel_11c24.bin`

## Boot Process

After the device is powered on or reset, the bootloader starts. It begins by verifying its own code. If verification fails, the bootloader halts. It then verifies the application. If the application is valid, the bootloader waits 250ms for a connection, then starts the application. If the application is not valid, the bootloader waits indefinitely for a connection.

Once the application starts, it also listens for a connection. If a connection is attempted, the application restarts the bootloader, which then waits indefinitely for the connection. If the application has a bug and does not restart the bootloader, the device can be manually reset to attempt a connection within the 250ms window.



# PC Programmer

## Usage

The PC programmer is very easy to use. It uses the Vector hardware to program the device over CAN.

Programming is accomplished with the following steps:

* Build the new application in MCUXpresso.
* Connect the Vector hardware to your computer and the bus the device is on.
* Turn on the device, if it is not already on.
* Open a command prompt and change to the `boot_pc` directory.
* Run the programmer `pc_programmer.py` with the path to the application memory image.
* If the programmer says `Tasks Complete`, programming was successful.

## Examples

To get help with the program:

`pc_programmer.py -h`

To program the dashboard (on Windows):

`pc_programmer.py ..\dash_11c24\Debug\dash_11c24.bin`

To check the current application in the dashboard:

`pc_programmer.py -d dashboard -c`

or

`pc_programmer.py ..\dash_11c24\Debug\dash_11c24.bin -c`

To check the the version of the application binary image:

`pc_programmer.py ..\dash_11c24\Debug\dash_11c24.bin -i`